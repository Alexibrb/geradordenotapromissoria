
{
  "entities": {
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client associated with promissory notes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the client."
        },
        "name": {
          "type": "string",
          "description": "Client's full name."
        },
        "address": {
          "type": "string",
          "description": "Client's address."
        },
        "cpf": {
          "type": "string",
          "description": "Client's CPF number."
        },
        "contactInformation": {
          "type": "string",
          "description": "Client's contact information (e.g., phone number, email)."
        }
      },
      "required": [
        "name",
        "address",
        "cpf"
      ]
    },
    "PromissoryNote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PromissoryNote",
      "type": "object",
      "description": "Represents a promissory note.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the promissory note."
        },
        "noteNumber": {
          "type": "string",
          "description": "Unique identifier number for the promissory note, generated from timestamp."
        },
        "clientId": {
          "type": "string",
          "description": "Reference to Client."
        },
        "productServiceReference": {
          "type": "string",
          "description": "Reference to the product or service associated with the note."
        },
        "value": {
          "type": "number",
          "description": "The total value of the promissory note."
        },
        "paymentDate": {
          "type": "string",
          "description": "The initial payment date for the promissory note.",
          "format": "date-time"
        },
        "numberOfInstallments": {
          "type": "number",
          "description": "The number of installments for the promissory note."
        },
        "paymentType": {
          "type": "string",
          "enum": ["a-vista", "a-prazo"],
          "description": "The payment type for the note."
        },
        "hasDownPayment": {
          "type": "boolean",
          "description": "Indicates if the installment plan includes a down payment."
        },
        "downPaymentValue": {
          "type": "number",
          "description": "The value of the down payment, if applicable."
        },
        "latePaymentClause": {
          "type": "string",
          "description": "A specific clause to be included in the note for late payments, only applicable for installment plans."
        }
      },
      "required": [
        "noteNumber",
        "clientId",
        "productServiceReference",
        "value",
        "paymentDate",
        "numberOfInstallments",
        "paymentType"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment made towards a promissory note.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment."
        },
        "promissoryNoteId": {
          "type": "string",
          "description": "Reference to PromissoryNote."
        },
        "paymentDate": {
          "type": "string",
          "description": "The date the payment was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount paid."
        },
        "receiptNumber": {
          "type": "string",
          "description": "Receipt number for the payment"
        }
      },
      "required": [
        "promissoryNoteId",
        "paymentDate",
        "amount"
      ]
    },
     "User": {
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user (matches auth UID)."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "User's email address."
        }
      },
      "required": ["id", "email"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
       {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/entities/User" },
          "description": "Stores user profile information. Document ID must match the user's auth UID."
        }
      },
      {
        "path": "/users/{userId}/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/entities/Client"
          },
          "description": "Stores client information for a specific user. Path-based ownership: only the authenticated user can access their own clients."
        }
      },
      {
        "path": "/users/{userId}/clients/{clientId}/promissoryNotes/{promissoryNoteId}",
        "definition": {
          "entityName": "PromissoryNote",
          "schema": {
            "$ref": "#/entities/PromissoryNote"
          },
          "description": "Stores promissory notes for a specific client of a user. Path-based ownership ensures data privacy."
        }
      },
      {
        "path": "/users/{userId}/clients/{clientId}/promissoryNotes/{promissoryNoteId}/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/entities/Payment"
          },
          "description": "Stores payment information for a specific promissory note. Path-based ownership ensures data privacy."
        }
      }
    ],
    "reasoning": "The Firestore structure is designed for a multi-user application. Each user's data (clients, promissory notes, payments) is stored in subcollections under their unique user document in the `users` collection. This enforces data isolation and simplifies security rules, as access control is based on the `userId` in the path."
  }
}
